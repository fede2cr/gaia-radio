# gaia-radio compose
#
# All containers use host networking so mDNS (avahi) can discover and
# announce services on the local LAN.  In production each container is
# expected to run on separate hardware (e.g. capture on a Raspberry Pi),
# so this compose file is mainly for development / single-host testing.

services:
  capture:
    build:
      context: ./capture
      dockerfile: Containerfile
    image: gaia-radio-capture
    container_name: gaia-radio-capture
    restart: unless-stopped
    network_mode: host
    devices:
      - /dev/bus/usb:/dev/bus/usb
    environment:
      - RTL_TCP_PORT=1234
      - RTL_TCP_DEVICE_INDEX=0

  processing:
    build:
      context: ./processing
      dockerfile: Containerfile
    image: gaia-radio-processing
    container_name: gaia-radio-processing
    restart: unless-stopped
    network_mode: host
    depends_on:
      - capture
    environment:
      - READSB_NET_BO_PORT=30005
      - READSB_NET_RO_PORT=30002
      - READSB_NET_SBS_PORT=30003
      - DISCOVERY_TIMEOUT=60

  web:
    build:
      context: ./web
      dockerfile: Containerfile
    image: gaia-radio-web
    container_name: gaia-radio-web
    restart: unless-stopped
    network_mode: host
    depends_on:
      - processing
    environment:
      - WEB_PORT=8080
      - DISCOVERY_TIMEOUT=60
